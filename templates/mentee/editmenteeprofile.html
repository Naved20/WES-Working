{% extends "base2.html" %}
{% block title %}Mentee Profile{% endblock %}

{% block user %}Mentee Profile{% endblock %}

{% block Sidebar %}

    <a href="{{ url_for('profile')}}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">üë§ My Profile</a>
    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">‚öôÔ∏è Settings</a>
    <a href="{{ url_for('logout')}}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">üö™ Sign out</a>

{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto mt-8 p-6 bg-gray-50 rounded-lg shadow-lg">
    <form id="menteeProfileForm" action="{{ url_for('editmenteeprofile') }}" method="POST" enctype="multipart/form-data" class="space-y-6" onsubmit="return validateMenteeForm()">
        <!-- Profile Header -->
        <div class="flex flex-col items-center md:flex-row md:items-center md:justify-start space-y-4 md:space-y-0 md:space-x-6 mb-8">
            <!-- Profile Picture Upload -->
            <div>
                {% if profile_picture %}
                <img src="{{ url_for('static', filename='uploads/' + profile_picture) }}" 
                     alt="Profile Picture" 
                     class="w-32 h-32 md:w-40 md:h-40 object-cover rounded-full shadow-md border-2 border-gray-200 mb-2">
                {% else %}
                <div class="w-32 h-32 md:w-40 md:h-40 flex items-center justify-center bg-gray-200 text-gray-500 rounded-full text-lg font-semibold mb-2">
                    No Picture
                </div>
                {% endif %}
                <input type="file" name="profile_picture" class="block text-sm text-gray-600">
            </div>

            <!-- Name & Email -->
            <div class="text-center md:text-left w-full">
                <label class="block text-gray-700 font-semibold">Full Name</label>
                <input type="text" name="full_name" value="{{ full_name }}" class="w-full p-2 border rounded-lg" readonly>

                <label class="block text-gray-700 font-semibold mt-2">Email</label>
                <input type="email" name="email" value="{{ email }}" class="w-full p-2 border rounded-lg" readonly>

                <label class="block text-gray-700 font-semibold mt-2">Date of Birth</label>
                <input type="date" name="dob" value="{{ dob }}" class="w-full p-2 border rounded-lg">

                <label class="block text-gray-700 font-semibold mt-2">School / College</label>
                <input type="text" name="school_college_name" value="{{ school_college_name }}" class="w-full p-2 border rounded-lg">
            </div>
        </div>

        <!-- Profile Details -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h3 class="text-2xl font-semibold text-gray-700 mb-4">Profile Details</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-semibold">Mobile Number</label>
                    <input type="text" name="mobile_number" value="{{ mobile_number }}" class="w-full p-2 border rounded-lg">

                    <label class="block text-gray-700 font-semibold mt-2">WhatsApp Number</label>
                    <input type="text" name="whatsapp_number" value="{{ whatsapp_number }}" class="w-full p-2 border rounded-lg">

                    <label class="block text-gray-700 font-semibold mt-2">Government / Private</label>
                    <input type="text" name="govt_private" value="{{ govt_private }}" class="w-full p-2 border rounded-lg">

                    <label class="block text-gray-700 font-semibold mt-2">Stream</label>
                    <input type="text" name="stream" value="{{ stream }}" class="w-full p-2 border rounded-lg">
                
                    <!-- Institution Selection - FIXED -->
<div class="mb-4">
    <label for="institution" class="block text-gray-700 font-semibold mb-2">Institution *</label>
    <select name="institution" id="institution" class="w-full p-2 border rounded-lg" required>
        <option value="">Select Your Institution</option>
        {% for inst in institutions %}
            <option value="{{ inst.name }}" 
                {% if institution == inst.name %}selected{% endif %}>
                {{ inst.name }}
            </option>
        {% endfor %}
        <option value="Other" 
            {% if institution == 'Other' or (institution and institution not in institutions|map(attribute='name')) %}selected{% endif %}>
            Other
        </option>
    </select>
</div>

<div class="mb-4" id="other_institution_field" 
     style="display: {% if institution == 'Other' or (institution and institution not in institutions|map(attribute='name')) %}block{% else %}none{% endif %};">
    <label for="other_institution_name" class="block text-gray-700 font-semibold mb-2">Specify Your Institution</label>
    <input type="text" name="other_institution_name" id="other_institution_name" 
           class="w-full p-2 border rounded-lg"
           placeholder="Enter your institution name"
           value="{% if institution == 'Other' or (institution and institution not in institutions|map(attribute='name')) %}{{ institution }}{% endif %}">
</div>
                
                
                
                </div>

                <div>
                    <label class="block text-gray-700 font-semibold">Class / Year</label>
                    <input type="text" name="class_year" value="{{ class_year }}" class="w-full p-2 border rounded-lg">

                    <label class="block text-gray-700 font-semibold mt-2">Favourite Subject</label>
                    <input type="text" name="favourite_subject" value="{{ favourite_subject }}" class="w-full p-2 border rounded-lg">

                    <label class="block text-gray-700 font-semibold mt-2">Goal / Future Aspiration</label>
                    <textarea name="goal" class="w-full p-2 border rounded-lg" rows="2">{{ goal }}</textarea>
                </div>
            </div>
        </div>

        <!-- Parent Info -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h3 class="text-2xl font-semibold text-gray-700 mb-4">Parent‚Äôs Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-semibold">Parent‚Äôs Name</label>
                    <input type="text" name="parent_name" value="{{ parent_name }}" class="w-full p-2 border rounded-lg">
                </div>
                <div>
                    <label class="block text-gray-700 font-semibold">Parent‚Äôs Mobile Number</label>
                    <input type="text" name="parent_mobile" value="{{ parent_mobile }}" class="w-full p-2 border rounded-lg">
                </div>
            </div>
        </div>

        <!-- Comments -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h3 class="text-2xl font-semibold text-gray-700 mb-4">Comments about Programme</h3>
            <textarea name="comments" class="w-full p-2 border rounded-lg" rows="4">{{ comments }}</textarea>
        </div>

        <!-- Terms Agreement -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h3 class="text-2xl font-semibold text-gray-700 mb-4">Terms & Conditions</h3>
            <select name="terms_agreement" class="w-full p-2 border rounded-lg">
                <option value="Yes" {% if terms_agreement == "Yes" %}selected{% endif %}>Yes</option>
                <option value="No" {% if terms_agreement == "No" %}selected{% endif %}>No</option>
            </select>
        </div>

        <!-- Submit Button -->
        <div class="text-center">
            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700">
                Save Profile
            </button>
        </div>
    </form>
</div>
<script>
    document.getElementById('institution').addEventListener('change', function() {
    const otherField = document.getElementById('other_institution_field');
    if (this.value === 'Other') {
        otherField.style.display = 'block';
        document.getElementById('other_institution_name').required = true;
    } else {
        otherField.style.display = 'none';
        document.getElementById('other_institution_name').required = false;
    }
});

// Form validation function for mentee
function validateMenteeForm() {
    const form = document.getElementById('menteeProfileForm');
    const requiredFields = [
        { name: 'dob', label: 'Date of Birth' },
        { name: 'school_college_name', label: 'School / College Name' },
        { name: 'mobile_number', label: 'Mobile Number' },
        { name: 'whatsapp_number', label: 'WhatsApp Number' },
        { name: 'govt_private', label: 'Government / Private' },
        { name: 'stream', label: 'Stream' },
        { name: 'class_year', label: 'Class / Year' },
        { name: 'favourite_subject', label: 'Favourite Subject' },
        { name: 'goal', label: 'Goal' },
        { name: 'parent_name', label: 'Parent Name' },
        { name: 'parent_mobile', label: 'Parent Mobile' },
        { name: 'comments', label: 'Comments' },
        { name: 'terms_agreement', label: 'Terms Agreement' }
    ];

    let emptyFields = [];

    requiredFields.forEach(field => {
        const element = form.elements[field.name];
        if (!element) return;

        let isEmpty = false;

        if (element.type === 'checkbox') {
            isEmpty = !element.checked;
        } else if (element.type === 'text' || element.type === 'email' || element.type === 'tel' || element.type === 'date') {
            isEmpty = !element.value.trim();
        } else if (element.type === 'select-one') {
            isEmpty = !element.value || element.value === '';
        } else if (element.tagName === 'TEXTAREA') {
            isEmpty = !element.value.trim();
        }

        if (isEmpty) {
            emptyFields.push(field.label);
            element.style.borderColor = '#ef4444';
            element.style.borderWidth = '2px';
        } else {
            element.style.borderColor = '';
            element.style.borderWidth = '';
        }
    });

    if (emptyFields.length > 0) {
        alert('‚ùå Please fill all mandatory fields:\n\n' + emptyFields.join('\n'));
        return false;
    }

    return true;
}

// Clear error styling when user starts typing
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('menteeProfileForm');
    if (form) {
        const inputs = form.querySelectorAll('input, select, textarea');
        inputs.forEach(input => {
            input.addEventListener('change', function() {
                this.style.borderColor = '';
                this.style.borderWidth = '';
            });
            input.addEventListener('input', function() {
                this.style.borderColor = '';
                this.style.borderWidth = '';
            });
        });
    }
});
</script>
{% endblock %}
