{% extends "base2.html" %}
{% block title %}My Tasks{% endblock %}
{% block user %}Mentee{% endblock %}
{% block profiledrop %}{% endblock %}
{% block content %}

<!-- Back Button -->
{% include 'components/back_button.html' with context %}

<style>
    .task-checkbox:checked+div {
        text-decoration: line-through;
        color: #9ca3af;
    }
</style>

<!-- Main Content Container -->
<main class="max-w-7xl mx-auto px-2 sm:px-3 lg:px-3 py-2 animate-fade-in">

    <!-- Header Section -->
    <section class="bg-white p-6 md:p-8 rounded-2xl shadow-lg border border-slate-100 mb-8 relative overflow-hidden">
        <div
            class="absolute top-0 right-0 w-64 h-64 bg-blue-50 rounded-full blur-3xl opacity-50 -mr-16 -mt-16 pointer-events-none">
        </div>

        <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8 relative z-10">
            <div>
                <h1 class="text-3xl font-bold text-slate-800 mb-2 flex items-center gap-2">
                    <span class="p-2 bg-blue-100 text-blue-600 rounded-lg shadow-sm">üìã</span>
                    My Tasks
                </h1>
                <p class="text-slate-500 font-medium">Manage your learning journey and assignments from mentors</p>
            </div>
            <button onclick="openCreateTaskModal()"
                class="px-5 py-2.5 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-500/30 flex items-center gap-2 group">
                <svg class="w-5 h-5 group-hover:rotate-90 transition-transform" fill="none" stroke="currentColor"
                    viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                </svg>
                Add Personal Task
            </button>
        </div>

        <!-- Statistics Cards -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div class="bg-slate-50 p-5 rounded-2xl border border-slate-100 hover:shadow-md transition-all group">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-3 bg-blue-100 rounded-xl group-hover:scale-110 transition-transform">
                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01">
                            </path>
                        </svg>
                    </div>
                    <span
                        class="text-xs font-bold text-blue-600 bg-blue-50 px-2 py-1 rounded-full border border-blue-100">All</span>
                </div>
                <div class="text-3xl font-bold text-slate-800 mb-1">{{ total_tasks }}</div>
                <div class="text-slate-500 text-sm font-medium">Total Tasks</div>
            </div>

            <div class="bg-slate-50 p-5 rounded-2xl border border-slate-100 hover:shadow-md transition-all group">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-3 bg-emerald-100 rounded-xl group-hover:scale-110 transition-transform">
                        <svg class="w-6 h-6 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <span
                        class="text-xs font-bold text-emerald-600 bg-emerald-50 px-2 py-1 rounded-full border border-emerald-100">Done</span>
                </div>
                <div class="text-3xl font-bold text-slate-800 mb-1">{{ completed_tasks }}</div>
                <div class="text-slate-500 text-sm font-medium">Completed</div>
            </div>

            <div class="bg-slate-50 p-5 rounded-2xl border border-slate-100 hover:shadow-md transition-all group">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-3 bg-amber-100 rounded-xl group-hover:scale-110 transition-transform">
                        <svg class="w-6 h-6 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    </div>
                    <span
                        class="text-xs font-bold text-amber-600 bg-amber-50 px-2 py-1 rounded-full border border-amber-100">Active</span>
                </div>
                <div class="text-3xl font-bold text-slate-800 mb-1">{{ pending_tasks }}</div>
                <div class="text-slate-500 text-sm font-medium">Pending Tasks</div>
            </div>

            <div class="bg-slate-50 p-5 rounded-2xl border border-slate-100 hover:shadow-md transition-all group">
                <div class="flex justify-between items-start mb-4">
                    <div class="p-3 bg-rose-100 rounded-xl group-hover:scale-110 transition-transform">
                        <svg class="w-6 h-6 text-rose-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z">
                            </path>
                        </svg>
                    </div>
                    {% if overdue_tasks > 0 %}
                    <span
                        class="text-xs font-bold text-rose-600 bg-rose-50 px-2 py-1 rounded-full border border-rose-100 animate-pulse">Action
                        Needed</span>
                    {% else %}
                    <span
                        class="text-xs font-bold text-slate-600 bg-slate-50 px-2 py-1 rounded-full border border-slate-100">Good</span>
                    {% endif %}
                </div>
                <div class="text-3xl font-bold text-slate-800 mb-1">{{ overdue_tasks }}</div>
                <div class="text-slate-500 text-sm font-medium">Overdue Tasks</div>
            </div>
        </div>
    </section>

    <!-- Filters and Search -->
    <section class="mb-8">
        <div
            class="flex flex-col md:flex-row gap-4 items-center justify-between bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
            <div class="flex flex-wrap gap-2 w-full md:w-auto">
                <button
                    class="filter-btn active px-4 py-2 rounded-lg text-sm font-medium transition-all bg-blue-600 text-white shadow-md shadow-blue-500/20"
                    data-filter="all">All Tasks</button>
                <button
                    class="filter-btn px-4 py-2 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 border border-transparent hover:border-slate-200 transition-all"
                    data-filter="pending">To Do</button>
                <button
                    class="filter-btn px-4 py-2 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 border border-transparent hover:border-slate-200 transition-all"
                    data-filter="in-progress">In Progress</button>
                <button
                    class="filter-btn px-4 py-2 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 border border-transparent hover:border-slate-200 transition-all"
                    data-filter="completed">Completed</button>
                <button
                    class="filter-btn px-4 py-2 rounded-lg text-sm font-medium text-slate-600 hover:bg-slate-50 border border-transparent hover:border-slate-200 transition-all"
                    data-filter="overdue">Overdue</button>
            </div>

            <div class="w-full md:w-auto">
                <div class="relative group">
                    <input type="text" id="task-search" placeholder="Search tasks..."
                        class="w-full md:w-64 pl-10 pr-4 py-2.5 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all group-hover:bg-white text-sm">
                    <svg class="w-5 h-5 absolute left-3 top-2.5 text-slate-400 group-hover:text-blue-500 transition-colors"
                        fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>
        </div>
    </section>

    <!-- Tasks List -->
    <section>
        <div id="tasks-container" class="space-y-6">
            <!-- Master Tasks (from Mentorship) -->
            {% for task in assigned_tasks %}
            <div class="task-card bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all group relative overflow-hidden
                {% if task.status == 'completed' %}border-l-4 border-l-emerald-500 opacity-75 hover:opacity-100{% endif %} 
                {% if task.status == 'overdue' or (task.due_date and task.due_date.date() < today and task.status != 'completed') %}border-l-4 border-l-rose-500{% else %}border-l-4 border-l-blue-500{% endif %}"
                data-task-type="master" data-task-id="{{ task.id }}">

                <div class="flex flex-col md:flex-row justify-between items-start gap-4 mb-4">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2 flex-wrap">
                            <span class="text-xs font-mono font-bold text-slate-400">#{{ task.serial }}</span>
                            <span
                                class="px-2.5 py-0.5 rounded-full text-xs font-bold bg-blue-50 text-blue-600 border border-blue-100 flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z">
                                    </path>
                                </svg>
                                Mentorship Task
                            </span>

                            <span class="task-status px-2.5 py-0.5 rounded-full text-xs font-bold border 
                                {% if task.status == 'pending' %}bg-amber-50 text-amber-600 border-amber-100
                                {% elif task.status == 'in-progress' %}bg-blue-50 text-blue-600 border-blue-100
                                {% elif task.status == 'completed' %}bg-emerald-50 text-emerald-600 border-emerald-100
                                {% else %}bg-rose-50 text-rose-600 border-rose-100{% endif %}">
                                {% if task.status == 'pending' %}To Do
                                {% elif task.status == 'in-progress' %}In Progress
                                {% elif task.status == 'completed' %}Completed
                                {% else %}Overdue{% endif %}
                            </span>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800 group-hover:text-blue-600 transition-colors">{{
                            task.master_task.journey_phase }}</h3>
                        <p class="text-slate-600 mt-2 text-sm leading-relaxed">{{ task.master_task.purpose_of_call }}
                        </p>
                    </div>

                    <div
                        class="flex items-center gap-2 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="viewTaskDetails({{ task.id }}, 'master')"
                            class="p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all"
                            title="View Details">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                </path>
                            </svg>
                        </button>
                        {% if task.status != 'completed' %}
                        <button onclick="markTaskAsComplete({{ task.id }}, 'master')"
                            class="p-2 text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-all"
                            title="Mark Complete">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                        </button>
                        {% endif %}
                    </div>
                </div>

                <div
                    class="flex flex-col md:flex-row justify-between items-center pt-4 border-t border-slate-50 mt-4 gap-4">
                    <div class="flex flex-wrap items-center gap-4 text-xs font-medium text-slate-500">
                        <div class="flex items-center gap-1.5 bg-slate-50 px-2 py-1 rounded-lg">
                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                            <span>Due: {{ task.due_date.strftime('%d %b %Y') if task.due_date else 'No due date'
                                }}</span>
                        </div>
                        <div class="flex items-center gap-1.5 bg-slate-50 px-2 py-1 rounded-lg">
                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span>{{ task.mentor.name if task.mentor else 'System' }}</span>
                        </div>
                        <div class="hidden md:block text-slate-300">|</div>
                        <span>Month: {{ task.month }}</span>
                        <span>Meeting: #{{ task.meeting_number }}</span>
                    </div>

                    {% if task.status != 'completed' %}
                    <div class="flex items-center gap-3 w-full md:w-auto">
                        <div class="w-full md:w-32 h-2 bg-slate-100 rounded-full overflow-hidden">
                            <div class="h-full bg-blue-500 rounded-full transition-all duration-500"
                                style="width: {{ task.progress or 0 }}%"></div>
                        </div>
                        <span class="text-xs font-bold text-slate-600 min-w-[30px]">{{ task.progress or 0 }}%</span>
                    </div>
                    {% else %}
                    <span
                        class="text-emerald-600 text-xs font-bold flex items-center gap-1 bg-emerald-50 px-2 py-1 rounded-lg">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Completed
                    </span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}

            <!-- Personal Tasks -->
            {% for task in personal_tasks %}
            <div class="task-card bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-all group relative overflow-hidden
                {% if task.status == 'completed' %}border-l-4 border-l-emerald-500 opacity-75 hover:opacity-100{% endif %} 
                {% if task.status == 'overdue' or (task.due_date and task.due_date.date() < today and task.status != 'completed') %}border-l-4 border-l-rose-500{% else %}border-l-4 border-l-green-500{% endif %}"
                data-task-type="personal" data-task-id="{{ task.id }}">

                <div class="flex flex-col md:flex-row justify-between items-start gap-4 mb-4">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2 flex-wrap">
                            <span class="text-xs font-mono font-bold text-slate-400">#{{ task.serial }}</span>
                            <span
                                class="px-2.5 py-0.5 rounded-full text-xs font-bold bg-green-50 text-green-600 border border-green-100 flex items-center gap-1">
                                <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                                    </path>
                                </svg>
                                Personal Task
                            </span>

                            <!-- Mentor Badge -->
                            {% if task.mentor %}
                            <span
                                class="px-2.5 py-0.5 rounded-full text-xs font-bold bg-purple-50 text-purple-600 border border-purple-100 flex items-center gap-1">
                                üë®‚Äçüè´ {{ task.mentor.name }}
                            </span>
                            {% else %}
                            <span
                                class="px-2.5 py-0.5 rounded-full text-xs font-bold bg-slate-50 text-slate-600 border border-slate-100 flex items-center gap-1">
                                üìù Self
                            </span>
                            {% endif %}

                            <!-- Priority Badge -->
                            {% if task.priority == 'high' %}
                            <span
                                class="px-2.5 py-0.5 rounded-full text-xs font-bold bg-rose-50 text-rose-600 border border-rose-100">High
                                Priority</span>
                            {% elif task.priority == 'medium' %}
                            <span
                                class="px-2.5 py-0.5 rounded-full text-xs font-bold bg-amber-50 text-amber-600 border border-amber-100">Medium
                                Priority</span>
                            {% else %}
                            <span
                                class="px-2.5 py-0.5 rounded-full text-xs font-bold bg-blue-50 text-blue-600 border border-blue-100">Low
                                Priority</span>
                            {% endif %}

                            <!-- Status Badge -->
                            <span class="task-status px-2.5 py-0.5 rounded-full text-xs font-bold border 
                                {% if task.status == 'pending' %}bg-amber-50 text-amber-600 border-amber-100
                                {% elif task.status == 'in-progress' %}bg-blue-50 text-blue-600 border-blue-100
                                {% elif task.status == 'completed' %}bg-emerald-50 text-emerald-600 border-emerald-100
                                {% else %}bg-rose-50 text-rose-600 border-rose-100{% endif %}">
                                {% if task.status == 'pending' %}To Do
                                {% elif task.status == 'in-progress' %}In Progress
                                {% elif task.status == 'completed' %}Completed
                                {% else %}Overdue{% endif %}
                            </span>
                        </div>
                        <h3 class="text-lg font-bold text-slate-800 group-hover:text-green-600 transition-colors">{{
                            task.title }}</h3>
                        <p class="text-slate-600 mt-2 text-sm leading-relaxed">{{ task.description or 'No description
                            provided' }}</p>
                    </div>

                    <div
                        class="flex items-center gap-2 opacity-100 md:opacity-0 group-hover:opacity-100 transition-opacity">
                        <button onclick="viewTaskDetails({{ task.id }}, 'personal')"
                            class="p-2 text-slate-400 hover:text-blue-600 hover:bg-blue-50 rounded-lg transition-all"
                            title="View Details">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z">
                                </path>
                            </svg>
                        </button>
                        {% if task.status != 'completed' %}
                        <button onclick="markTaskAsComplete({{ task.id }}, 'personal')"
                            class="p-2 text-slate-400 hover:text-emerald-600 hover:bg-emerald-50 rounded-lg transition-all"
                            title="Mark Complete">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M5 13l4 4L19 7"></path>
                            </svg>
                        </button>
                        {% endif %}
                    </div>
                </div>

                <div
                    class="flex flex-col md:flex-row justify-between items-center pt-4 border-t border-slate-50 mt-4 gap-4">
                    <div class="flex flex-wrap items-center gap-4 text-xs font-medium text-slate-500">
                        <div class="flex items-center gap-1.5 bg-slate-50 px-2 py-1 rounded-lg">
                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                            <span>Due: {{ task.due_date.strftime('%d %b %Y') if task.due_date else 'No due date'
                                }}</span>
                        </div>
                        <div class="flex items-center gap-1.5 bg-slate-50 px-2 py-1 rounded-lg">
                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <span>Created: {{ task.created_date.strftime('%d %b %Y') if task.created_date else 'N/A'
                                }}</span>
                        </div>
                        {% if task.mentor %}
                        <div class="flex items-center gap-1.5 bg-slate-50 px-2 py-1 rounded-lg">
                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span>Mentor: {{ task.mentor.name }}</span>
                        </div>
                        {% endif %}
                    </div>

                    {% if task.status != 'completed' %}
                    <div class="flex items-center gap-3 w-full md:w-auto">
                        <div class="w-full md:w-32 h-2 bg-slate-100 rounded-full overflow-hidden">
                            <div class="h-full bg-green-500 rounded-full transition-all duration-500"
                                style="width: {{ task.progress or 0 }}%"></div>
                        </div>
                        <span class="text-xs font-bold text-slate-600 min-w-[30px]">{{ task.progress or 0 }}%</span>
                    </div>
                    {% else %}
                    <span
                        class="text-emerald-600 text-xs font-bold flex items-center gap-1 bg-emerald-50 px-2 py-1 rounded-lg">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Completed
                    </span>
                    {% endif %}
                </div>
            </div>
            {% endfor %}

            <!-- Empty State -->
            <div id="empty-state"
                class="empty-state {% if assigned_tasks or personal_tasks %}hidden{% endif %} py-12 px-4">
                <div class="bg-slate-50 rounded-2xl p-8 border border-dashed border-slate-300 max-w-lg mx-auto">
                    <div
                        class="w-16 h-16 bg-blue-100 text-blue-600 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z">
                            </path>
                        </svg>
                    </div>
                    <h3 class="text-xl font-bold text-slate-800 mb-2">No tasks found</h3>
                    <p class="text-slate-500 mb-6">Get started by creating your first task or check back later for
                        assignments from your mentors.</p>
                    <button onclick="openCreateTaskModal()"
                        class="px-6 py-2.5 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-500/30 flex items-center gap-2 mx-auto">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4">
                            </path>
                        </svg>
                        Create Your First Task
                    </button>
                </div>
            </div>
        </div>
        <!-- Close id="tasks-container" which seemed to be missing closing tag in my previous view, wait I see space-y-4 at line 151, closed at line 407?? No line 407 was just endfor. -->
    </section>

    <!-- Task Details Modal with Rating Section -->
    <div id="task-details-modal"
        class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300">
        <div
            class="bg-white rounded-2xl p-8 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto shadow-2xl transform scale-100 transition-all">
            <div class="flex justify-between items-start mb-6 pb-4 border-b border-slate-100">
                <div>
                    <h3 id="detail-task-title" class="text-2xl font-bold text-slate-800">Task Title</h3>
                    <p class="text-sm text-slate-500 mt-1 flex items-center gap-2">
                        <span id="detail-journey-phase" class="font-medium text-slate-600">Journey Phase</span>
                        <span class="text-slate-300">|</span>
                        <span id="detail-task-month"
                            class="bg-slate-100 text-slate-600 px-2 py-0.5 rounded text-xs font-bold">Month 1</span>
                    </p>
                </div>
                <button onclick="closeTaskDetailsModal()"
                    class="text-slate-400 hover:text-slate-600 transition-colors p-2 hover:bg-slate-50 rounded-full">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                        </path>
                    </svg>
                </button>
            </div>

            <div class="space-y-6">
                <!-- Task Meta -->
                <div
                    class="grid grid-cols-2 md:grid-cols-3 gap-6 text-sm bg-slate-50 p-4 rounded-xl border border-slate-100">
                    <div>
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Status</span>
                        <span id="detail-task-status"
                            class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800">
                            Pending
                        </span>
                    </div>
                    <div>
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Due
                            Date</span>
                        <span id="detail-task-due-date" class="font-semibold text-slate-700 flex items-center gap-1">
                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                                </path>
                            </svg>
                            2024-01-15
                        </span>
                    </div>
                    <div>
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider block mb-1">Assigned
                            by</span>
                        <span id="detail-task-mentor" class="font-semibold text-slate-700 flex items-center gap-1">
                            <svg class="w-4 h-4 text-slate-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            Dr. Sarah Johnson
                        </span>
                    </div>
                </div>

                <div id="master-fields" style="display: none;" class="space-y-6">
                    <!-- Mentor Focus -->
                    <div>
                        <h4 class="text-sm font-bold text-slate-800 mb-2 flex items-center gap-2">
                            <span class="w-1.5 h-1.5 bg-blue-500 rounded-full"></span>
                            Mentor Focus
                        </h4>
                        <div
                            class="bg-blue-50/50 p-4 rounded-xl border border-blue-100 text-slate-700 text-sm leading-relaxed">
                            <p id="detail-mentor-focus">Mentor focus details...</p>
                        </div>
                    </div>
                </div>

                <!-- Description -->
                <div>
                    <h4 class="text-sm font-bold text-slate-800 mb-2 flex items-center gap-2">
                        <span class="w-1.5 h-1.5 bg-slate-500 rounded-full"></span>
                        Description
                    </h4>
                    <div
                        class="bg-slate-50 p-4 rounded-xl border border-slate-200 text-slate-600 text-sm leading-relaxed">
                        <p id="detail-task-description">Task description will appear here...</p>
                    </div>
                </div>

                <!-- Progress -->
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="text-sm font-bold text-slate-800">Progress</h4>
                        <span id="detail-progress-text" class="text-sm font-bold text-blue-600">0%</span>
                    </div>
                    <div class="h-2.5 bg-slate-100 rounded-full overflow-hidden">
                        <div id="detail-progress-fill"
                            class="h-full bg-blue-600 rounded-full transition-all duration-500 shadow-sm shadow-blue-500/30"
                            style="width: 0%"></div>
                    </div>
                </div>

                <!-- ‚úÖ RATING SECTION - ONLY IN MODAL -->
                <div id="rating-section" class="bg-amber-50/50 p-5 rounded-xl border border-amber-100">
                    <h4 class="font-bold text-amber-800 text-lg mb-3 flex items-center gap-2">
                        <span>‚≠ê</span> Mentor Rating & Feedback
                    </h4>

                    <div id="rating-display">
                        <div id="no-rating-message" class="text-center py-6">
                            <div
                                class="inline-flex items-center justify-center w-12 h-12 rounded-full bg-amber-100 text-amber-500 mb-3">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z">
                                    </path>
                                </svg>
                            </div>
                            <p class="text-amber-800 font-medium">No rating provided yet</p>
                            <p class="text-sm text-amber-600/80 mt-1">Your mentor will provide feedback after task
                                completion.</p>
                        </div>

                        <div id="rating-details" class="hidden">
                            <div class="flex items-center gap-3 mb-5 pb-4 border-b border-amber-200/50">
                                <div id="display-stars" class="flex gap-1 text-2xl text-amber-400"></div>
                                <span id="rating-score"
                                    class="font-bold text-slate-700 text-xl bg-white px-3 py-1 rounded-lg border border-slate-100 shadow-sm"></span>
                                <span id="rating-date"
                                    class="text-xs font-medium text-slate-400 ml-auto uppercase tracking-wide"></span>
                            </div>

                            <div class="space-y-4">
                                <div>
                                    <label
                                        class="text-xs font-bold text-slate-500 uppercase tracking-wider block mb-2">Values
                                        & Feedback</label>
                                    <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm">
                                        <p id="display-feedback" class="text-slate-600 text-sm leading-relaxed"></p>
                                    </div>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label
                                            class="text-xs font-bold text-emerald-600 uppercase tracking-wider block mb-2 flex items-center gap-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M5 13l4 4L19 7"></path>
                                            </svg>
                                            Strengths
                                        </label>
                                        <div class="bg-emerald-50/50 p-3 rounded-xl border border-emerald-100 h-full">
                                            <p id="display-strengths" class="text-slate-600 text-sm"></p>
                                        </div>
                                    </div>
                                    <div>
                                        <label
                                            class="text-xs font-bold text-blue-600 uppercase tracking-wider block mb-2 flex items-center gap-1">
                                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                    d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z">
                                                </path>
                                            </svg>
                                            Areas for Improvement
                                        </label>
                                        <div class="bg-blue-50/50 p-3 rounded-xl border border-blue-100 h-full">
                                            <p id="display-improvements" class="text-slate-600 text-sm"></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Actions -->
                <div class="flex gap-3 pt-6 border-t border-slate-100">
                    <button onclick="markTaskComplete()"
                        class="px-5 py-2.5 bg-emerald-600 text-white font-medium rounded-xl hover:bg-emerald-700 transition shadow-lg shadow-emerald-500/30 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7">
                            </path>
                        </svg>
                        Mark Complete
                    </button>
                    <button onclick="startTaskProgress()"
                        class="px-5 py-2.5 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-500/30 flex items-center gap-2">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z">
                            </path>
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        Start Progress
                    </button>
                    <button onclick="closeTaskDetailsModal()"
                        class="px-5 py-2.5 bg-slate-100 text-slate-600 font-medium rounded-xl hover:bg-slate-200 transition ml-auto">
                        Close
                    </button>
                </div>
            </div>
        </div>
    </div>

</main>

<!-- Create Task Modal -->
<div id="create-task-modal"
    class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center z-50 hidden transition-opacity duration-300">
    <div class="bg-white rounded-2xl p-8 w-full max-w-lg mx-4 shadow-2xl transform scale-100 transition-all">
        <div class="flex justify-between items-center mb-6">
            <h3 class="text-2xl font-bold text-slate-800">Create New Task</h3>
            <button onclick="closeCreateTaskModal()"
                class="text-slate-400 hover:text-slate-600 transition-colors p-2 hover:bg-slate-50 rounded-full">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12">
                    </path>
                </svg>
            </button>
        </div>

        <form id="create-task-form" class="space-y-5">
            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Task Title</label>
                <input type="text" id="task-title"
                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 font-medium text-slate-800 placeholder-slate-400 transition-all"
                    placeholder="What do you need to do?" required>
            </div>

            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Description</label>
                <textarea id="task-description" rows="3"
                    class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 font-medium text-slate-800 placeholder-slate-400 transition-all"
                    placeholder="Add more details about this task..."></textarea>
            </div>

            <div class="grid grid-cols-2 gap-5">
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Due Date</label>
                    <input type="date" id="task-due-date"
                        class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 font-medium text-slate-800 transition-all">
                </div>
                <div>
                    <label class="block text-sm font-semibold text-slate-700 mb-2">Priority</label>
                    <div class="relative">
                        <select id="task-priority"
                            class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 font-medium text-slate-800 appearance-none transition-all">
                            <option value="low">Low Priority</option>
                            <option value="medium" selected>Medium Priority</option>
                            <option value="high">High Priority</option>
                        </select>
                        <svg class="w-5 h-5 absolute right-3 top-3.5 text-slate-400 pointer-events-none" fill="none"
                            stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7">
                            </path>
                        </svg>
                    </div>
                </div>
            </div>

            <div>
                <label class="block text-sm font-semibold text-slate-700 mb-2">Assign Under Mentor</label>
                <div class="relative">
                    <select id="task-mentor"
                        class="w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 font-medium text-slate-800 appearance-none transition-all">
                        <option value="self">üìù Self (Personal Task)</option>
                        {% for mentor in mentors_list %}
                        <option value="{{ mentor.id }}">üë®‚Äçüè´ {{ mentor.name }}</option>
                        {% endfor %}
                    </select>
                    <svg class="w-5 h-5 absolute right-3 top-3.5 text-slate-400 pointer-events-none" fill="none"
                        stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <p class="text-xs text-slate-500 mt-2 flex items-center gap-1">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                    Choose a mentor to track this task under their guidance
                </p>
            </div>

            <div class="flex justify-end gap-3 mt-8 pt-4 border-t border-slate-100">
                <button type="button" onclick="closeCreateTaskModal()"
                    class="px-5 py-2.5 text-slate-600 hover:text-slate-800 font-medium transition-colors">Cancel</button>
                <button type="submit"
                    class="px-6 py-2.5 bg-blue-600 text-white font-medium rounded-xl hover:bg-blue-700 transition shadow-lg shadow-blue-500/30 flex items-center gap-2">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
                    </svg>
                    Create Task
                </button>
            </div>
        </form>
    </div>
</div>




<script>
    // Global variables
    let currentTaskId = null;
    let currentTaskType = null;

    // Filter functions
    function filterTasks(filter) {
        const taskCards = document.querySelectorAll('.task-card');
        const emptyState = document.getElementById('empty-state');
        let visibleCount = 0;

        taskCards.forEach(card => {
            const statusBadge = card.querySelector('.task-status');
            if (!statusBadge) return;
            
            const status = statusBadge.textContent.trim().toLowerCase().replace(' ', '-');
            const shouldShow = filter === 'all' ||
                (filter === 'pending' && status === 'to-do') ||
                (filter === 'in-progress' && status === 'in-progress') ||
                (filter === 'completed' && status === 'completed') ||
                (filter === 'overdue' && status === 'overdue');

            card.style.display = shouldShow ? 'block' : 'none';
            if (shouldShow) visibleCount++;
        });

        // Update filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active', 'bg-blue-600', 'text-white', 'shadow-md', 'shadow-blue-500/20');
            btn.classList.add('text-slate-600', 'hover:bg-slate-50', 'border', 'border-transparent', 'hover:border-slate-200');
            
            if (btn.dataset.filter === filter) {
                btn.classList.remove('text-slate-600', 'hover:bg-slate-50', 'border', 'border-transparent', 'hover:border-slate-200');
                btn.classList.add('active', 'bg-blue-600', 'text-white', 'shadow-md', 'shadow-blue-500/20');
            }
        });

        // Show/hide empty state
        if (emptyState) {
            emptyState.classList.toggle('hidden', visibleCount > 0);
        }
    }

    // Search functionality
    document.getElementById('task-search')?.addEventListener('input', function (e) {
        const searchTerm = e.target.value.toLowerCase();
        const taskCards = document.querySelectorAll('.task-card');
        let visibleCount = 0;

        taskCards.forEach(card => {
            const title = card.querySelector('h3')?.textContent.toLowerCase() || '';
            const description = card.querySelector('p')?.textContent.toLowerCase() || '';
            const shouldShow = title.includes(searchTerm) || description.includes(searchTerm);

            card.style.display = shouldShow ? 'block' : 'none';
            if (shouldShow) visibleCount++;
        });

        const emptyState = document.getElementById('empty-state');
        if (emptyState) {
            emptyState.classList.toggle('hidden', visibleCount > 0);
        }
    });

    // Mark task as complete
    async function markTaskAsComplete(taskId, taskType) {
        if (!confirm('Are you sure you want to mark this task as complete?')) return;

        try {
            const response = await fetch('/update_task_status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    task_id: taskId,
                    task_type: taskType,
                    status: 'completed',
                    progress: 100
                })
            });

            const result = await response.json();

            if (result.success) {
                location.reload();
            } else {
                alert('Error: ' + result.message);
            }
        } catch (error) {
            console.error('Error updating task status:', error);
            alert('Error updating task status');
        }
    }

    // View task details and load rating
    async function viewTaskDetails(taskId, taskType) {
        try {
            const response = await fetch(`/get_task_details/${taskId}?type=${taskType}`);
            const result = await response.json();

            if (result.success) {
                const task = result.task;
                currentTaskId = task.id;
                currentTaskType = task.type;

                console.log('Task details loaded:', task);

                // Populate modal with task details
                document.getElementById('detail-task-title').textContent = task.title;
                document.getElementById('detail-task-description').textContent = task.description;
                document.getElementById('detail-task-due-date').textContent = task.due_date || 'No due date';
                document.getElementById('detail-task-mentor').textContent = task.assigned_by;
                document.getElementById('detail-task-month').textContent = task.month || 'N/A';

                // Show/hide fields based on task type
                const masterFields = document.getElementById('master-fields');
                if (task.type === 'master' && masterFields) {
                    document.getElementById('detail-mentor-focus').textContent = task.mentor_focus || 'Not specified';
                    document.getElementById('detail-journey-phase').textContent = task.journey_phase || 'Not specified';
                    masterFields.style.display = 'block';
                } else if (masterFields) {
                    masterFields.style.display = 'none';
                }

                // Update status
                const statusElement = document.getElementById('detail-task-status');
                if (statusElement) {
                    statusElement.textContent = task.status.charAt(0).toUpperCase() + task.status.slice(1);
                    statusElement.className = 'inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium';
                    
                    if (task.status === 'pending') {
                        statusElement.classList.add('bg-amber-100', 'text-amber-800');
                    } else if (task.status === 'in-progress') {
                        statusElement.classList.add('bg-blue-100', 'text-blue-800');
                    } else if (task.status === 'completed') {
                        statusElement.classList.add('bg-emerald-100', 'text-emerald-800');
                    } else {
                        statusElement.classList.add('bg-rose-100', 'text-rose-800');
                    }
                }

                // Update progress
                const progress = task.progress || 0;
                document.getElementById('detail-progress-fill').style.width = `${progress}%`;
                document.getElementById('detail-progress-text').textContent = `${progress}%`;

                // Load and display rating
                await loadAndDisplayRating(taskId, taskType);

                // Show modal
                document.getElementById('task-details-modal').classList.remove('hidden');
            } else {
                alert('Error: ' + result.message);
            }
        } catch (error) {
            console.error('Error loading task details:', error);
            alert('Error loading task details');
        }
    }

    // Load and display rating in modal
    async function loadAndDisplayRating(taskId, taskType) {
        try {
            console.log('üîç Loading rating for task:', taskId, taskType);

            const response = await fetch(`/mentee_get_task_rating/${taskType}/${taskId}`);

            if (!response.ok) {
                console.error('‚ùå Rating fetch failed with status:', response.status);
                return;
            }

            const result = await response.json();
            console.log('‚úÖ Rating data received:', result);

            const noRatingMsg = document.getElementById('no-rating-message');
            const ratingDetails = document.getElementById('rating-details');

            if (!noRatingMsg || !ratingDetails) {
                console.warn('‚ùå Rating display elements not found');
                return;
            }

            if (result.success && result.rating) {
                // Hide "no rating" message and show rating details
                noRatingMsg.classList.add('hidden');
                ratingDetails.classList.remove('hidden');

                // Display stars
                const starsContainer = document.getElementById('display-stars');
                if (starsContainer) {
                    starsContainer.innerHTML = '';
                    for (let i = 1; i <= 5; i++) {
                        const star = document.createElement('span');
                        star.className = i <= result.rating.rating ? 'text-yellow-400' : 'text-gray-300';
                        star.innerHTML = '‚òÖ';
                        starsContainer.appendChild(star);
                    }
                }

                // Display rating details
                const ratingScore = document.getElementById('rating-score');
                const ratingDate = document.getElementById('rating-date');
                const displayFeedback = document.getElementById('display-feedback');
                const displayStrengths = document.getElementById('display-strengths');
                const displayImprovements = document.getElementById('display-improvements');

                if (ratingScore) ratingScore.textContent = `${result.rating.rating}/5`;
                if (ratingDate) ratingDate.textContent = `Rated on ${new Date(result.rating.rated_at).toLocaleDateString()}`;
                if (displayFeedback) displayFeedback.textContent = result.rating.feedback || 'No overall feedback provided';
                if (displayStrengths) displayStrengths.textContent = result.rating.strengths || 'Not specified';
                if (displayImprovements) displayImprovements.textContent = result.rating.improvements || 'Not specified';

            } else {
                // No rating found - show "no rating" message
                noRatingMsg.classList.remove('hidden');
                ratingDetails.classList.add('hidden');
            }
        } catch (error) {
            console.error('‚ùå Error loading rating:', error);
            // On error, show "no rating" message
            const noRatingMsg = document.getElementById('no-rating-message');
            const ratingDetails = document.getElementById('rating-details');
            if (noRatingMsg) noRatingMsg.classList.remove('hidden');
            if (ratingDetails) ratingDetails.classList.add('hidden');
        }
    }

    // Modal functions
    function openCreateTaskModal() {
        document.getElementById('create-task-modal').classList.remove('hidden');
    }

    function closeCreateTaskModal() {
        document.getElementById('create-task-modal').classList.add('hidden');
        document.getElementById('create-task-form').reset();
    }

    function closeTaskDetailsModal() {
        document.getElementById('task-details-modal').classList.add('hidden');

        // Reset rating section to default state
        const noRatingMsg = document.getElementById('no-rating-message');
        const ratingDetails = document.getElementById('rating-details');
        if (noRatingMsg) noRatingMsg.classList.remove('hidden');
        if (ratingDetails) ratingDetails.classList.add('hidden');

        currentTaskId = null;
        currentTaskType = null;
    }

    // Additional modal functions
    async function markTaskComplete() {
        if (currentTaskId && currentTaskType) {
            await markTaskAsComplete(currentTaskId, currentTaskType);
            closeTaskDetailsModal();
        }
    }

    async function startTaskProgress() {
        if (!currentTaskId || !currentTaskType) return;

        try {
            const response = await fetch('/update_task_status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    task_id: currentTaskId,
                    task_type: currentTaskType,
                    status: 'in-progress',
                    progress: 25
                })
            });

            const result = await response.json();

            if (result.success) {
                alert('Task progress started!');
                closeTaskDetailsModal();
                location.reload();
            } else {
                alert('Error: ' + result.message);
            }
        } catch (error) {
            console.error('Error updating task status:', error);
            alert('Error updating task status');
        }
    }

    // Edit personal task function
    function editPersonalTask(taskId) {
        // Implement edit functionality here
        alert('Edit functionality for task: ' + taskId);
    }

    // Initialize event listeners
    document.addEventListener('DOMContentLoaded', function () {
        // Filter buttons
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => filterTasks(btn.dataset.filter));
        });

        // Create task form
        const createTaskForm = document.getElementById('create-task-form');
        if (createTaskForm) {
            createTaskForm.addEventListener('submit', async function (e) {
                e.preventDefault();

                const title = document.getElementById('task-title').value;
                const description = document.getElementById('task-description').value;
                const dueDate = document.getElementById('task-due-date').value;
                const priority = document.getElementById('task-priority').value;
                const mentorId = document.getElementById('task-mentor').value;

                try {
                    const response = await fetch('/create_personal_task', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            title: title,
                            description: description,
                            due_date: dueDate,
                            priority: priority,
                            mentor_id: mentorId
                        })
                    });

                    const result = await response.json();

                    if (result.success) {
                        alert(result.message);
                        closeCreateTaskModal();
                        location.reload();
                    } else {
                        alert('Error: ' + result.message);
                    }
                } catch (error) {
                    console.error('Error creating task:', error);
                    alert('Error creating task');
                }
            });
        }
    });
</script>

{% endblock %}