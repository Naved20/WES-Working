{% extends "base2.html" %}
{% block title %}Mentee Profile{% endblock %}

{% block user %}Mentee Profile{% endblock %}

{% block Sidebar %}
    <a href="{{ url_for('profile')}}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">üë§ My Profile</a>
    <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">‚öôÔ∏è Settings</a>
    <a href="{{ url_for('logout')}}" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100">üö™ Sign out</a>
{% endblock %}

{% block content %}
<!-- Back Button -->
{% include 'components/back_button.html' with context %}

<div class="max-w-4xl mx-auto mt-8 p-6 bg-gray-50 rounded-lg shadow-lg">
    <form id="menteeProfileForm" action="{{ url_for('editmenteeprofile') }}" method="POST" enctype="multipart/form-data" class="space-y-6" onsubmit="return validateMenteeForm()">
        
        <!-- Profile Header -->
        <div class="flex flex-col items-center md:flex-row md:items-center md:justify-start space-y-4 md:space-y-0 md:space-x-6 mb-8">
            <!-- Profile Picture Upload -->
            <div>
                {% if profile_picture %}
                <img src="{{ url_for('static', filename='uploads/' + profile_picture) }}" 
                     alt="Profile Picture" 
                     class="w-32 h-32 md:w-40 md:h-40 object-cover rounded-full shadow-md border-2 border-gray-200 mb-2">
                <p class="text-xs text-gray-500 mb-1">Current picture uploaded</p>
                <input type="file" name="profile_picture" class="block text-sm text-gray-600" accept="image/*">
                <p class="text-xs text-gray-400">Leave empty to keep current picture</p>
                {% else %}
                <div class="w-32 h-32 md:w-40 md:h-40 flex items-center justify-center bg-gray-200 text-gray-500 rounded-full text-lg font-semibold mb-2">
                    No Picture
                </div>
                <input type="file" name="profile_picture" class="block text-sm text-gray-600" required accept="image/*">
                <p class="text-xs text-red-500">* Profile picture is required</p>
                {% endif %}
            </div>

            <!-- Name & Email -->
            <div class="text-center md:text-left w-full">
                <label class="block text-gray-700 font-semibold">Full Name</label>
                <input type="text" name="full_name" value="{{ full_name }}" class="w-full p-2 border rounded-lg" readonly>

                <label class="block text-gray-700 font-semibold mt-2">Email</label>
                <input type="email" name="email" value="{{ email }}" class="w-full p-2 border rounded-lg" readonly>

                <label class="block text-gray-700 font-semibold mt-2">Date of Birth</label>
                <input type="date" name="dob" value="{{ dob }}" class="w-full p-2 border rounded-lg">
            </div>
        </div>

        <!-- MANDATORY: Who am I? -->
        {% if not who_am_i %}
        <div id="who_am_i_section" class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h3 class="text-2xl font-semibold text-gray-700 mb-4">Who am I? *</h3>
            <div class="relative">
                <select name="who_am_i" id="who_am_i_select" class="w-full p-3 border-2 border-gray-300 rounded-lg appearance-none bg-white cursor-pointer focus:border-blue-500 focus:ring-2 focus:ring-blue-200 transition" required onchange="lockWhoAmI()">
                    <option value="">-- Select who you are --</option>
                    <option value="school_student">School Student</option>
                    <option value="university_student">University Student</option>
                    <option value="seeking_internship">Seeking Student Job / Internship</option>
                    <option value="young_professional">Young Professional</option>
                    <option value="exploring">Exploring, Still Unsure</option>
                </select>
                <!-- Custom dropdown arrow SVG -->
                <svg class="absolute right-3 top-1/2 transform -translate-y-1/2 w-5 h-5 text-gray-600 pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"/>
                </svg>
            </div>
            <p class="text-xs text-gray-500 mt-2">Once selected, this cannot be changed</p>
        </div>
        {% else %}
        <!-- LOCKED: Who am I? Display (shown after selection) -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-blue-200 bg-blue-50">
            <h3 class="text-2xl font-semibold text-gray-700 mb-4">Who am I?</h3>
            <div class="p-4 bg-white rounded-lg border-2 border-blue-300">
                <p class="text-lg font-semibold text-blue-700" id="who_am_i_display">
                    {% if who_am_i == 'school_student' %}üéí School Student
                    {% elif who_am_i == 'university_student' %}üéì University Student
                    {% elif who_am_i == 'seeking_internship' %}üíº Seeking Student Job / Internship
                    {% elif who_am_i == 'young_professional' %}üëî Young Professional
                    {% elif who_am_i == 'exploring' %}üîç Exploring, Still Unsure
                    {% endif %}
                </p>
                <p class="text-xs text-gray-500 mt-2">üîí This selection is permanent and cannot be changed</p>
            </div>
            <input type="hidden" name="who_am_i" value="{{ who_am_i }}">
        </div>
        {% endif %}

        <!-- STUDENT SECTION -->
        <div id="student_section" class="hidden space-y-4">
            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">Education Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-semibold">Current Education Level *</label>
                        <select name="education_level" class="w-full p-2 border rounded-lg" onchange="toggleSchoolSection()">
                            <option value="">Select Level</option>
                            <option value="School 9-12" {% if education_level == 'School 9-12' %}selected{% endif %}>School (9-12)</option>
                            <option value="Diploma" {% if education_level == 'Diploma' %}selected{% endif %}>Diploma</option>
                            <option value="Undergraduate" {% if education_level == 'Undergraduate' %}selected{% endif %}>Undergraduate</option>
                            <option value="Postgraduate" {% if education_level == 'Postgraduate' %}selected{% endif %}>Postgraduate</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Institution Name *</label>
                        <input type="text" name="institution_name" value="{{ institution_name or '' }}" class="w-full p-2 border rounded-lg" placeholder="School / College / University">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Board / University *</label>
                        <input type="text" name="board_university" value="{{ board_university or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., CBSE, ICSE, State Board">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Course / Stream *</label>
                        <input type="text" name="course_stream" value="{{ course_stream or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., Science, Commerce, Arts">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Class / Year / Semester *</label>
                        <input type="text" name="class_year" value="{{ class_year or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., 10th, 12th, 1st Year">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Favourite Subject/Area of Interest</label>
                        <input type="text" name="favourite_subject" value="{{ favourite_subject or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., Mathematics, Physics">
                    </div>

                </div>
            </div>

            <!-- School Details Section (conditional) -->
            <div id="school_details_section" class="hidden bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">School Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-semibold">School Name *</label>
                        <input type="text" name="school_name" value="{{ school_name or '' }}" class="w-full p-2 border rounded-lg" placeholder="Your school name">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Board *</label>
                        <input type="text" name="school_board" value="{{ school_board or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., CBSE, ICSE">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Passing Year</label>
                        <input type="number" name="school_passing_year" value="{{ school_passing_year or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., 2025">
                    </div>
                </div>
            </div>
        </div>

        <!-- PROFESSIONAL SECTION -->
        <div id="professional_section" class="hidden space-y-4">
            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">Professional Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-semibold">Current Role / Designation *</label>
                        <input type="text" name="current_role" value="{{ current_role or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., Software Engineer, Teacher">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Industry / Domain *</label>
                        <input type="text" name="industry" value="{{ industry or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., IT, Education, Finance">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Years of Experience *</label>
                        <input type="number" name="years_experience" value="{{ years_experience or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., 5" min="0">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Current Organization / Company *</label>
                        <input type="text" name="current_organization" value="{{ current_organization or '' }}" class="w-full p-2 border rounded-lg" placeholder="Company or School name">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Key Skills *</label>
                        <input type="text" name="key_skills" value="{{ key_skills or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., Python, Leadership, Teaching">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Career Goal *</label>
                        <select name="career_goal" class="w-full p-2 border rounded-lg">
                            <option value="">Select Goal</option>
                            <option value="Growth" {% if career_goal == 'Growth' %}selected{% endif %}>Growth</option>
                            <option value="Switch" {% if career_goal == 'Switch' %}selected{% endif %}>Career Switch</option>
                            <option value="Leadership" {% if career_goal == 'Leadership' %}selected{% endif %}>Leadership</option>
                            <option value="Startup" {% if career_goal == 'Startup' %}selected{% endif %}>Startup</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- ENTREPRENEUR SECTION -->
        <div id="entrepreneur_section" class="hidden space-y-4">
            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">Startup Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-semibold">Startup Stage *</label>
                        <select name="startup_stage" class="w-full p-2 border rounded-lg">
                            <option value="">Select Stage</option>
                            <option value="Idea" {% if startup_stage == 'Idea' %}selected{% endif %}>Idea</option>
                            <option value="MVP" {% if startup_stage == 'MVP' %}selected{% endif %}>MVP</option>
                            <option value="Early Revenue" {% if startup_stage == 'Early Revenue' %}selected{% endif %}>Early Revenue</option>
                            <option value="Scaling" {% if startup_stage == 'Scaling' %}selected{% endif %}>Scaling</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Startup Name</label>
                        <input type="text" name="startup_name" value="{{ startup_name or '' }}" class="w-full p-2 border rounded-lg" placeholder="Your startup name">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Industry / Problem Area *</label>
                        <input type="text" name="startup_industry" value="{{ startup_industry or '' }}" class="w-full p-2 border rounded-lg" placeholder="What problem are you solving?">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Team Size *</label>
                        <input type="number" name="team_size" value="{{ team_size or '' }}" class="w-full p-2 border rounded-lg" placeholder="Number of team members" min="1">
                    </div>
                    <div class="md:col-span-2">
                        <label class="block text-gray-700 font-semibold">Main Challenge *</label>
                        <textarea name="main_challenge" class="w-full p-2 border rounded-lg" rows="3" placeholder="What's your biggest challenge right now?">{{ main_challenge or '' }}</textarea>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Type of Mentorship Needed *</label>
                        <select name="mentorship_type" class="w-full p-2 border rounded-lg">
                            <option value="">Select Type</option>
                            <option value="Tech" {% if mentorship_type == 'Tech' %}selected{% endif %}>Tech</option>
                            <option value="Business" {% if mentorship_type == 'Business' %}selected{% endif %}>Business</option>
                            <option value="Funding" {% if mentorship_type == 'Funding' %}selected{% endif %}>Funding</option>
                            <option value="Growth" {% if mentorship_type == 'Growth' %}selected{% endif %}>Growth</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- FREELANCER SECTION -->
        <div id="freelancer_section" class="hidden space-y-4">
            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">Freelance Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-semibold">Skill / Service Offered *</label>
                        <input type="text" name="freelance_skill" value="{{ freelance_skill or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., Web Design, Content Writing">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Experience Level *</label>
                        <select name="freelance_experience" class="w-full p-2 border rounded-lg">
                            <option value="">Select Level</option>
                            <option value="Beginner" {% if freelance_experience == 'Beginner' %}selected{% endif %}>Beginner</option>
                            <option value="Intermediate" {% if freelance_experience == 'Intermediate' %}selected{% endif %}>Intermediate</option>
                            <option value="Advanced" {% if freelance_experience == 'Advanced' %}selected{% endif %}>Advanced</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Platforms Used</label>
                        <input type="text" name="freelance_platforms" value="{{ freelance_platforms or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., Upwork, Fiverr, Freelancer">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Biggest Challenge *</label>
                        <select name="freelance_challenge" class="w-full p-2 border rounded-lg">
                            <option value="">Select Challenge</option>
                            <option value="Clients" {% if freelance_challenge == 'Clients' %}selected{% endif %}>Finding Clients</option>
                            <option value="Pricing" {% if freelance_challenge == 'Pricing' %}selected{% endif %}>Pricing Strategy</option>
                            <option value="Scaling" {% if freelance_challenge == 'Scaling' %}selected{% endif %}>Scaling</option>
                            <option value="Skill Growth" {% if freelance_challenge == 'Skill Growth' %}selected{% endif %}>Skill Growth</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- CAREER BREAK SECTION -->
        <div id="career_break_section" class="hidden space-y-4">
            <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
                <h3 class="text-2xl font-semibold text-gray-700 mb-4">Career Break Details</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-gray-700 font-semibold">Last Role or Education *</label>
                        <input type="text" name="last_role" value="{{ last_role or '' }}" class="w-full p-2 border rounded-lg" placeholder="e.g., Software Engineer, 12th Pass">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Reason for Career Break</label>
                        <input type="text" name="career_break_reason" value="{{ career_break_reason or '' }}" class="w-full p-2 border rounded-lg" placeholder="Optional">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Field to Restart Career *</label>
                        <input type="text" name="restart_field" value="{{ restart_field or '' }}" class="w-full p-2 border rounded-lg" placeholder="What field do you want to restart in?">
                    </div>
                    <div>
                        <label class="block text-gray-700 font-semibold">Support Expected *</label>
                        <select name="support_expected" class="w-full p-2 border rounded-lg">
                            <option value="">Select Support</option>
                            <option value="Skill" {% if support_expected == 'Skill' %}selected{% endif %}>Skill Development</option>
                            <option value="Guidance" {% if support_expected == 'Guidance' %}selected{% endif %}>Guidance</option>
                            <option value="Confidence" {% if support_expected == 'Confidence' %}selected{% endif %}>Confidence Building</option>
                            <option value="Placement" {% if support_expected == 'Placement' %}selected{% endif %}>Placement Help</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- COMMON FIELDS FOR ALL -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h3 class="text-2xl font-semibold text-gray-700 mb-4">Contact Information</h3>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-gray-700 font-semibold">Mobile Number *</label>
                    <div class="flex gap-2">
                        <input type="text" name="mobile_country_code" list="country_codes" value="{{ mobile_country_code or '+91' }}" class="w-24 p-2 border rounded-lg" placeholder="+91">
                        <input type="tel" name="mobile_number" value="{{ mobile_number or '' }}" class="flex-1 p-2 border rounded-lg" placeholder="Enter mobile number">
                    </div>
                </div>
                <div>
                    <label class="block text-gray-700 font-semibold">WhatsApp Number *</label>
                    <div class="flex gap-2">
                        <input type="text" name="whatsapp_country_code" list="country_codes" value="{{ whatsapp_country_code or '+91' }}" class="w-24 p-2 border rounded-lg" placeholder="+91">
                        <input type="tel" name="whatsapp_number" value="{{ whatsapp_number or '' }}" class="flex-1 p-2 border rounded-lg" placeholder="Enter WhatsApp number">
                    </div>
                </div>
            </div>
        </div>

        <!-- MENTORSHIP EXPECTATIONS -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h3 class="text-2xl font-semibold text-gray-700 mb-4">My Expectation from Mentorship programme *</h3>
            <p class="text-gray-600 text-sm mb-3">Briefly describe what you expect to gain from this mentorship (guidance, clarity, skills, career direction, networking, etc.)</p>
            <textarea name="mentorship_expectations" class="w-full p-2 border rounded-lg" rows="4" placeholder="Share your expectations...">{{ mentorship_expectations or '' }}</textarea>
        </div>

        <!-- Terms Agreement -->
        <div class="bg-white p-6 rounded-lg shadow-sm border border-gray-200">
            <h3 class="text-2xl font-semibold text-gray-700 mb-4">Terms & Conditions</h3>
            <div class="flex items-center">
                <input type="checkbox" id="terms_checkbox" name="terms_agreement" value="Yes" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" {% if terms_agreement == 'Yes' %}checked{% endif %} required>
                <label for="terms_checkbox" class="ml-2 text-gray-700">I agree to the Terms & Conditions of the mentorship programme</label>
            </div>
            <div class="flex items-center">
                <input type="checkbox" id="terms_checkbox" name="terms_agreement" value="Yes" class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500" {% if terms_agreement == 'Yes' %}checked{% endif %} required>
                <label for="terms_checkbox" class="ml-2 text-gray-700">Your personal data will be treated in accordence with GDPR</label>
            </div>
        </div>

        <!-- Submit Button -->
        <div class="text-center">
            <button type="submit" class="px-6 py-2 bg-blue-600 text-white rounded-lg shadow hover:bg-blue-700">
                Save Profile
            </button>
        </div>
    </form>
</div>

<datalist id="country_codes">
    <option value="+91">India</option>
    <option value="+1">USA/Canada</option>
    <option value="+44">UK</option>
    <option value="+971">UAE</option>
    <option value="+966">Saudi Arabia</option>
    <option value="+65">Singapore</option>
    <option value="+61">Australia</option>
    <option value="+49">Germany</option>
    <option value="+33">France</option>
    <option value="+81">Japan</option>
    <option value="+86">China</option>
    <option value="+92">Pakistan</option>
    <option value="+880">Bangladesh</option>
    <option value="+977">Nepal</option>
    <option value="+94">Sri Lanka</option>
    <option value="+60">Malaysia</option>
    <option value="+63">Philippines</option>
    <option value="+82">South Korea</option>
    <option value="+39">Italy</option>
    <option value="+34">Spain</option>
    <option value="+7">Russia</option>
    <option value="+55">Brazil</option>
    <option value="+52">Mexico</option>
    <option value="+27">South Africa</option>
    <option value="+20">Egypt</option>
    <option value="+234">Nigeria</option>
    <option value="+254">Kenya</option>
    <option value="+352">Luxembourg</option>
    <option value="+32">Belgium</option>
    <option value="+43">Austria</option>
    <option value="+358">Finland</option>
    <option value="+351">Portugal</option>
    <option value="+30">Greece</option>
</datalist>

<script>
let whoAmILocked = false;

const whoAmILabels = {
    'student': 'üë®‚Äçüéì Student',
    'professional': 'üíº Working Professional / Teacher',
    'entrepreneur': 'üöÄ Entrepreneur / Founder',
    'freelancer': 'üéØ Freelancer',
    'career_break': '‚è∏Ô∏è Career Break / Job Seeker'
};

function lockWhoAmI() {
    const select = document.getElementById('who_am_i_select');
    const value = select.value;
    
    // If already locked, don't do anything
    if (whoAmILocked || select.disabled) {
        return;
    }
    
    if (value) {
        // Save to database immediately via AJAX
        fetch('/save_who_am_i', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ who_am_i: value })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                whoAmILocked = true;
                // Hide the dropdown section
                document.getElementById('who_am_i_section').classList.add('hidden');
                // Show the locked display section
                document.getElementById('who_am_i_locked_section').classList.remove('hidden');
                document.getElementById('who_am_i_display').textContent = whoAmILabels[value];
                updateFormFields();
            } else {
                alert('Error saving selection. Please try again.');
                select.value = '';
            }
        })
        .catch(error => {
            alert('Error saving selection. Please try again.');
            console.error(error);
            select.value = '';
        });
    }
}

function updateFormFields() {
    // Get who_am_i value from either hidden input or select
    const hiddenInput = document.querySelector('input[name="who_am_i"]');
    const selectInput = document.getElementById('who_am_i_select');
    
    let whoAmI = null;
    if (hiddenInput) {
        whoAmI = hiddenInput.value;
    } else if (selectInput) {
        whoAmI = selectInput.value;
    }
    
    document.getElementById('student_section').classList.add('hidden');
    document.getElementById('professional_section').classList.add('hidden');
    document.getElementById('entrepreneur_section').classList.add('hidden');
    document.getElementById('freelancer_section').classList.add('hidden');
    document.getElementById('career_break_section').classList.add('hidden');
    
    if (whoAmI === 'student') {
        document.getElementById('student_section').classList.remove('hidden');
    } else if (whoAmI === 'professional') {
        document.getElementById('professional_section').classList.remove('hidden');
    } else if (whoAmI === 'entrepreneur') {
        document.getElementById('entrepreneur_section').classList.remove('hidden');
    } else if (whoAmI === 'freelancer') {
        document.getElementById('freelancer_section').classList.remove('hidden');
    } else if (whoAmI === 'career_break') {
        document.getElementById('career_break_section').classList.remove('hidden');
    }
}

function toggleSchoolSection() {
    const educationLevel = document.querySelector('select[name="education_level"]').value;
    const schoolSection = document.getElementById('school_details_section');
    
    if (educationLevel === 'School 9-12') {
        schoolSection.classList.remove('hidden');
    } else {
        schoolSection.classList.add('hidden');
    }
}

function validateMenteeForm() {
    const whoAmI = document.querySelector('select[name="who_am_i"]').value;
    
    if (!whoAmI) {
        alert('‚ùå Please select "Who am I?"');
        return false;
    }

    const commonRequired = ['mobile_number', 'whatsapp_number', 'mentorship_expectations'];
    let emptyFields = [];

    commonRequired.forEach(field => {
        const element = document.querySelector(`[name="${field}"]`);
        if (element && !element.value.trim()) {
            emptyFields.push(field.replace(/_/g, ' '));
        }
    });

    const sectionRequired = {
        student: ['education_level', 'institution_name', 'board_university', 'course_stream', 'class_year', 'career_interest'],
        professional: ['current_role', 'industry', 'years_experience', 'current_organization', 'key_skills', 'career_goal'],
        entrepreneur: ['startup_stage', 'startup_industry', 'team_size', 'main_challenge', 'mentorship_type'],
        freelancer: ['freelance_skill', 'freelance_experience', 'freelance_challenge'],
        career_break: ['last_role', 'restart_field', 'support_expected']
    };

    if (sectionRequired[whoAmI]) {
        sectionRequired[whoAmI].forEach(field => {
            const element = document.querySelector(`[name="${field}"]`);
            if (element && !element.value.trim()) {
                emptyFields.push(field.replace(/_/g, ' '));
            }
        });
    }

    if (emptyFields.length > 0) {
        alert('‚ùå Please fill all mandatory fields:\n\n' + emptyFields.join('\n'));
        return false;
    }

    return true;
}

document.addEventListener('DOMContentLoaded', function() {
    // Check if who_am_i already exists (hidden input or select)
    const hiddenInput = document.querySelector('input[name="who_am_i"]');
    const selectInput = document.getElementById('who_am_i_select');
    
    let whoAmI = null;
    
    if (hiddenInput) {
        // Already locked - get value from hidden input
        whoAmI = hiddenInput.value;
    } else if (selectInput) {
        // Not locked yet - get value from select (will be empty on first load)
        whoAmI = selectInput.value;
    }
    
    console.log('Who am I value on load:', whoAmI); // Debug
    
    if (whoAmI && whoAmI !== '') {
        // Show the appropriate section
        updateFormFields();
    }
});
</script>

{% endblock %}
