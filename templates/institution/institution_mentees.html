{% extends "base2.html" %}

{% block title %}Institution Mentees{% endblock %}
{% block user %}Institution{% endblock %}

{% block content %}
<div class="bg-white rounded-xl shadow-sm">
    <div class="p-6 border-b border-gray-200">
        <h2 class="text-2xl font-semibold text-gray-800 mb-2">Institution Mentees</h2>
        <p class="text-gray-600">Browse all mentees associated with your institution</p>
    </div>
    
    <div class="p-6 bg-gray-50 border-b border-gray-200">
        <!-- Search Input -->
        <input type="text" id="searchMentees" placeholder="Search mentees by name, school, stream..."
               class="w-full p-3 mb-4 border border-gray-300 rounded-lg"
               onkeyup="filterMentees()">
        
        <!-- Filters -->
        <div class="flex flex-wrap items-center gap-3">
          <!-- School/College -->
          <div class="relative">
            <select id="schoolFilter" onchange="filterMentees()" class="appearance-none pl-4 pr-10 py-2 border rounded-full text-gray-700 bg-white">
              <option value="">All Schools</option>
              {% set schools = [] %}
              {% for mentee in mentees %}
                {% if mentee.mentee_profile and mentee.mentee_profile.school_college_name and mentee.mentee_profile.school_college_name not in schools %}
                  {% set _ = schools.append(mentee.mentee_profile.school_college_name) %}
                  <option value="{{ mentee.mentee_profile.school_college_name }}">{{ mentee.mentee_profile.school_college_name }}</option>
                {% endif %}
              {% endfor %}
            </select>
          </div>

          <!-- Stream -->
          <div class="relative">
            <select id="streamFilter" onchange="filterMentees()" class="appearance-none pl-4 pr-10 py-2 border rounded-full text-gray-700 bg-white">
              <option value="">All Streams</option>
              {% set streams = [] %}
              {% for mentee in mentees %}
                {% if mentee.mentee_profile and mentee.mentee_profile.stream and mentee.mentee_profile.stream not in streams %}
                  {% set _ = streams.append(mentee.mentee_profile.stream) %}
                  <option value="{{ mentee.mentee_profile.stream }}">{{ mentee.mentee_profile.stream }}</option>
                {% endif %}
              {% endfor %}
            </select>
          </div>

          <!-- Class/Year -->
          <div class="relative">
            <select id="classFilter" onchange="filterMentees()" class="appearance-none pl-4 pr-10 py-2 border rounded-full text-gray-700 bg-white">
              <option value="">All Classes</option>
              {% set classes = [] %}
              {% for mentee in mentees %}
                {% if mentee.mentee_profile and mentee.mentee_profile.class_year and mentee.mentee_profile.class_year not in classes %}
                  {% set _ = classes.append(mentee.mentee_profile.class_year) %}
                  <option value="{{ mentee.mentee_profile.class_year }}">{{ mentee.mentee_profile.class_year }}</option>
                {% endif %}
              {% endfor %}
            </select>
          </div>
        </div>
    </div>

    <!-- Mentees Grid -->
    <div class="p-6">
      {% if mentees and mentees|length > 0 %}
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="menteesContainer">
        {% for mentee in mentees %}
        <div class="mentee-card bg-white rounded-xl border border-gray-200 p-5 transition-all hover:shadow-md"
             data-school="{{ mentee.mentee_profile.school_college_name if mentee.mentee_profile else '' }}"
             data-stream="{{ mentee.mentee_profile.stream if mentee.mentee_profile else '' }}"
             data-class="{{ mentee.mentee_profile.class_year if mentee.mentee_profile else '' }}"
             data-name="{{ mentee.name.lower() }}">
          <div class="flex items-center gap-4 mb-4">
            {% if mentee.mentee_profile and mentee.mentee_profile.profile_picture %}
              <img src="{{ url_for('static', filename='uploads/' ~ mentee.mentee_profile.profile_picture) }}" 
                   alt="{{ mentee.name }}" 
                   class="w-16 h-16 rounded-full object-cover border-2 border-white shadow">
            {% else %}
              <div class="w-16 h-16 rounded-full bg-gradient-to-br from-green-100 to-green-200 flex items-center justify-center text-green-600 border-2 border-white shadow">
                <span class="text-xl font-semibold">{{ mentee.name[0] if mentee.name else '?' }}</span>
              </div>
            {% endif %}
            <div>
              <h3 class="text-lg font-bold text-gray-800 mentee-name">{{ mentee.name }}</h3>
              <p class="text-sm text-gray-600">{{ mentee.email }}</p>
              {% if mentee.mentee_profile and mentee.mentee_profile.stream %}
                <p class="text-sm text-green-600 font-semibold">{{ mentee.mentee_profile.stream }}</p>
              {% endif %}
            </div>
          </div>
          
          <div class="space-y-2 mb-4">
            {% if mentee.mentee_profile %}
              {% if mentee.mentee_profile.school_college_name %}
              <div class="flex items-center text-sm text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C6.228 6.228 2 10.228 2 15s4.228 8.772 10 8.772c5.771 0 10-3.926 10-8.771 0-4.772-4.229-8.747-10-8.747z" />
                </svg>
                <span>{{ mentee.mentee_profile.school_college_name }}</span>
              </div>
              {% endif %}
              
              {% if mentee.mentee_profile.class_year %}
              <div class="flex items-center text-sm text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span>{{ mentee.mentee_profile.class_year }}</span>
              </div>
              {% endif %}
              
              {% if mentee.mentee_profile.goal %}
              <div class="flex items-start text-sm text-gray-600">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2 text-gray-500 flex-shrink-0 mt-0.5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                </svg>
                <span class="italic">{{ mentee.mentee_profile.goal }}</span>
              </div>
              {% endif %}
            {% endif %}
          </div>
          
          <button onclick="openMenteeProfileModal(
              '{{ mentee.name }}',
              '{{ mentee.mentee_profile.stream if mentee.mentee_profile else '' }}',
              '{{ mentee.mentee_profile.school_college_name if mentee.mentee_profile else '' }}',
              '{{ mentee.mentee_profile.goal if mentee.mentee_profile else '' }}',
              '{{ mentee.mentee_profile.dob if mentee.mentee_profile else '' }}',
              '{{ mentee.mentee_profile.mobile_number if mentee.mentee_profile else '' }}',
              '{{ mentee.mentee_profile.whatsapp_number if mentee.mentee_profile else '' }}',
              '{{ mentee.mentee_profile.parent_name if mentee.mentee_profile else '' }}',
              '{{ mentee.mentee_profile.parent_mobile if mentee.mentee_profile else '' }}',
              '{{ mentee.mentee_profile.comments if mentee.mentee_profile else '' }}',
              '{{ url_for('static', filename='uploads/' + mentee.mentee_profile.profile_picture) if mentee.mentee_profile and mentee.mentee_profile.profile_picture else 'https://via.placeholder.com/100' }}',
              '{{ mentee.mentee_profile.class_year if mentee.mentee_profile else '' }}',
              '{{ mentee.mentee_profile.favourite_subject if mentee.mentee_profile else '' }}'
          )" class="block w-full text-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
            View Profile
          </button>
        </div>
        {% endfor %}
      </div>
      {% else %}
        <div class="text-center py-12">
          <div class="text-6xl mb-4">ðŸŽ“</div>
          <h3 class="text-2xl font-semibold text-gray-700 mb-2">No Mentees Found</h3>
          <p class="text-gray-600">There are no mentees registered from your institution yet.</p>
        </div>
      {% endif %}
    </div>
</div>

<!-- Mentee Profile Modal -->
<div id="menteeProfileModal" class="fixed inset-0 hidden bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
  <div class="bg-white rounded-2xl shadow-xl w-full max-w-3xl max-h-[90vh] overflow-y-auto relative">

    <!-- Close Button -->
    <button onclick="closeMenteeProfileModal()" 
      class="absolute top-5 right-5 text-gray-400 hover:text-gray-600 transition-colors duration-200 text-xl bg-white rounded-full p-1 shadow-sm z-10">
      âœ•
    </button>

    <!-- Header -->
    <div class="sticky top-0 bg-white z-10 px-8 pt-8 pb-4 border-b border-gray-100">
      <h2 class="text-2xl font-bold text-gray-800 flex items-center">
        <svg class="w-6 h-6 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
        </svg>
        Mentee Profile
      </h2>
    </div>

    <!-- Content -->
    <div class="p-8">
      <!-- Profile Picture + Basic Info -->
      <div class="flex flex-col md:flex-row items-center gap-6 mb-8">
        <div class="relative">
          <img id="menteeModalProfilePic" src="" alt="Profile Picture" class="w-28 h-28 rounded-full object-cover border-4 border-blue-50 shadow-sm">
        </div>
        <div class="text-center md:text-left">
          <h3 id="menteeModalName" class="text-2xl font-bold text-gray-800 mb-1"></h3>
          <p id="menteeModalStream" class="text-gray-600 mb-1"></p>
          <p id="menteeModalGoal" class="text-gray-500 mb-1"></p>
        </div>
      </div>

      <!-- Details Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6 text-gray-700 mb-8">
        <div class="space-y-4">
          <div class="flex items-start">
            <svg class="w-5 h-5 text-gray-400 mr-3 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M8 9a3 3 0 016 0v1a3 3 0 01-6 0V9z" />
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M12 14v7m0 0h4m-4 0H8" />
            </svg>
            <div>
              <p class="font-medium text-gray-600">Date of Birth</p>
              <p id="menteeModalDOB" class="text-gray-800"></p>
            </div>
          </div>

          <div class="flex items-start">
            <svg class="w-5 h-5 text-gray-400 mr-3 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                    d="M12 14l9-5-9-5-9 5 9 5z"></path>
            </svg>
            <div>
              <p class="font-medium text-gray-600">Class / Year</p>
              <p id="menteeModalClass" class="text-gray-800"></p>
            </div>
          </div>

          <div class="flex items-start">
            <svg class="w-5 h-5 text-gray-400 mr-3 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 20h9"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M12 4h9M4 9h16M4 15h16"></path>
            </svg>
            <div>
              <p class="font-medium text-gray-600">Favourite Subject</p>
              <p id="menteeModalSubject" class="text-gray-800"></p>
            </div>
          </div>
        </div>

        <div class="space-y-4">
          <div class="flex items-start">
            <svg class="w-5 h-5 text-gray-400 mr-3 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M16 12a4 4 0 01-8 0V6a4 4 0 118 0v6zM12 14v7"></path>
            </svg>
            <div>
              <p class="font-medium text-gray-600">Parent Name</p>
              <p id="menteeModalParentName" class="text-gray-800"></p>
            </div>
          </div>

          <div class="flex items-start">
            <svg class="w-5 h-5 text-gray-400 mr-3 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 016.412 9m6.088 9h7M11 21l5-10 5 10M12.751 5C11.783 10.77 8.07 15.61 3 18.129"></path>
            </svg>
            <div>
              <p class="font-medium text-gray-600">Parent Mobile</p>
              <p id="menteeModalParentMobile" class="text-gray-800"></p>
            </div>
          </div>

          <div class="flex items-start">
            <svg class="w-5 h-5 text-gray-400 mr-3 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M3 10h18M3 14h18M7 10v4m10-4v4"></path>
            </svg>
            <div>
              <p class="font-medium text-gray-600">Mobile / WhatsApp</p>
              <p id="menteeModalMobile" class="text-gray-800"></p>
            </div>
          </div>
        </div>
      </div>

      <!-- Comments -->
      <div class="mb-8">
        <h4 class="font-semibold text-gray-800 flex items-center mb-4">
          <svg class="w-5 h-5 text-blue-600 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"></path>
          </svg>
          Comments
        </h4>
        <div class="bg-gray-50 p-5 rounded-lg border border-gray-100">
          <p id="menteeModalComments" class="text-gray-600 italic"></p>
        </div>
      </div>

      <!-- Footer Buttons -->
      <div class="flex flex-col sm:flex-row justify-end gap-3 pt-4 border-t border-gray-100">
        <button onclick="closeMenteeProfileModal()" class="px-5 py-2.5 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200 font-medium">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
function openMenteeProfileModal(name, stream, school, goal, dob, mobile, whatsapp, parentName, parentMobile, comments, profilePic, classYear, subject) {
    document.getElementById('menteeModalName').innerText = name || "Not specified";
    document.getElementById('menteeModalStream').innerText = (stream ? stream + " at " : "") + (school || "Not specified");
    document.getElementById('menteeModalGoal').innerText = "Goal: " + (goal || "Not specified");
    document.getElementById('menteeModalDOB').innerText = dob || "Not specified";
    document.getElementById('menteeModalClass').innerText = classYear || "Not specified";
    document.getElementById('menteeModalSubject').innerText = subject || "Not specified";
    document.getElementById('menteeModalParentName').innerText = parentName || "Not specified";
    document.getElementById('menteeModalParentMobile').innerText = parentMobile || "Not specified";
    document.getElementById('menteeModalMobile').innerText = mobile || whatsapp || "Not specified";
    document.getElementById('menteeModalComments').innerText = comments || "None";
    document.getElementById('menteeModalProfilePic').src = profilePic;

    document.getElementById('menteeProfileModal').classList.remove('hidden');
}

function closeMenteeProfileModal() {
    document.getElementById('menteeProfileModal').classList.add('hidden');
}

function filterMentees() {
    const searchTerm = document.getElementById('searchMentees').value.toLowerCase();
    const schoolFilter = document.getElementById('schoolFilter').value.toLowerCase();
    const streamFilter = document.getElementById('streamFilter').value.toLowerCase();
    const classFilter = document.getElementById('classFilter').value.toLowerCase();
    
    const menteeCards = document.querySelectorAll('.mentee-card');
    
    menteeCards.forEach(card => {
        const menteeName = card.getAttribute('data-name');
        const menteeSchool = card.getAttribute('data-school').toLowerCase();
        const menteeStream = card.getAttribute('data-stream').toLowerCase();
        const menteeClass = card.getAttribute('data-class').toLowerCase();
        
        const matchesSearch = menteeName.includes(searchTerm) || 
                              menteeSchool.includes(searchTerm) || 
                              menteeStream.includes(searchTerm);
        const matchesSchool = !schoolFilter || menteeSchool === schoolFilter;
        const matchesStream = !streamFilter || menteeStream === streamFilter;
        const matchesClass = !classFilter || menteeClass === classFilter;
        
        if (matchesSearch && matchesSchool && matchesStream && matchesClass) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
}
</script>

<style>
  .relative select {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3E%3Cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3E%3C/svg%3E");
    background-position: right 0.5rem center;
    background-repeat: no-repeat;
    background-size: 1.5em 1.5em;
    padding-right: 2.5rem;
  }
</style>

{% endblock %}
