{% extends "base.html" %}
{% block title %}Sign Up{% endblock %}
{% block content %}

<section class="flex justify-center items-center">
    <div id="signup-page" class="w-full max-w-md">
        <div class="bg-white p-8 rounded-xl shadow-lg border border-gray-200">
            <h2 class="text-3xl font-bold text-center mb-6">Create an Account</h2>
            
            <!-- Display Flash Messages -->
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="mb-4 p-3 rounded-md {% if category == 'error' %}bg-red-100 text-red-700 border border-red-300{% else %}bg-green-100 text-green-700 border border-green-300{% endif %}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}
            
            <form id="signup-form" class="space-y-4" method="POST" action="/signup" onsubmit="return validateSignupForm()">
                
                <!-- Name -->
                <div>
                    <label for="signup-name" class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                    <input type="text" id="signup-name" name="name" placeholder="Enter your full name"
                        class="mt-1 block w-full px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors duration-200"
                        required
                        minlength="2"
                        maxlength="50"
                        pattern="[A-Za-z\s]{2,50}"
                        title="Name should be 2-50 characters long and contain only letters and spaces">
                    <div id="name-error" class="text-red-500 text-xs mt-1 hidden">Please enter a valid name (2-50 characters, letters and spaces only)</div>
                </div>
                
                <!-- Email -->
                <div>
                    <label for="signup-email" class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                    <input type="email" id="signup-email" name="email" placeholder="Enter your email"
                        class="mt-1 block w-full px-3 py-2 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors duration-200"
                        required
                        pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                        title="Please enter a valid email address">
                    <div id="email-error" class="text-red-500 text-xs mt-1 hidden">Please enter a valid email address</div>
                </div>
                
                <!-- User Type - Compact Version -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">I am a:</label>
                    <div class="mt-1 flex justify-between gap-2">
                        <!-- <label class="flex-1 flex items-center justify-center p-2 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-500 transition-colors duration-200 text-center">
                            <input type="radio" name="user-type" value="0" class="sr-only">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full flex items-center justify-center mr-2">
                                <div class="w-2 h-2 bg-blue-600 rounded-full hidden"></div>
                            </div>
                            <span class="text-xs font-medium text-gray-700 whitespace-nowrap">Supervisor</span>
                        </label> -->
                        <label class="flex-1 flex items-center justify-center p-2 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-500 transition-colors duration-200 text-center">
                            <input type="radio" name="user-type" value="1" class="sr-only">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full flex items-center justify-center mr-2">
                                <div class="w-2 h-2 bg-blue-600 rounded-full hidden"></div>
                            </div>
                            <span class="text-xs font-medium text-gray-700 whitespace-nowrap">Mentor</span>
                        </label>
                        <label class="flex-1 flex items-center justify-center p-2 border-2 border-gray-200 rounded-lg cursor-pointer hover:border-blue-500 transition-colors duration-200 text-center">
                            <input type="radio" name="user-type" value="2" class="sr-only">
                            <div class="w-4 h-4 border-2 border-gray-300 rounded-full flex items-center justify-center mr-2">
                                <div class="w-2 h-2 bg-blue-600 rounded-full hidden"></div>
                            </div>
                            <span class="text-xs font-medium text-gray-700 whitespace-nowrap">Mentee</span>
                        </label>
                    </div>
                    <div id="user-type-error" class="text-red-500 text-xs mt-1 hidden">Please select your role</div>
                </div>
                
                <!-- Password -->
                <div class="relative">
                    <label for="signup-password" class="block text-sm font-medium text-gray-700 mb-1">Password</label>
                    <div class="relative">
                        <input type="password" id="signup-password" name="password" placeholder="Enter password"
                            class="mt-1 block w-full px-3 py-2 pr-10 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors duration-200"
                            required
                            minlength="6"
                            maxlength="20"
                            pattern="^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{6,20}$"
                            title="Password must be 6-20 characters with uppercase, lowercase, number, and special character">
                        <button type="button" id="toggle-password" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors duration-200"
                                style="top: 50%; transform: translateY(-50%);">
                            <svg id="eye-icon" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            <svg id="eye-slash-icon" class="h-5 w-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="password-error" class="text-red-500 text-xs mt-1 hidden"></div>
                </div>
                
                <!-- Password Requirements Popup -->
                <div id="password-popup" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full mx-4">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-semibold text-gray-800">Password Requirements</h3>
                            <button type="button" id="close-popup" class="text-gray-500 hover:text-gray-700">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="text-sm text-gray-600 mb-4">Your password must meet the following requirements:</p>
                        <ul class="space-y-2 text-sm">
                            <li id="popup-req-length" class="flex items-center">
                                <svg class="w-5 h-5 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                At least 6 characters long
                            </li>
                            <li id="popup-req-uppercase" class="flex items-center">
                                <svg class="w-5 h-5 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                At least one uppercase letter (A-Z)
                            </li>
                            <li id="popup-req-lowercase" class="flex items-center">
                                <svg class="w-5 h-5 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                At least one lowercase letter (a-z)
                            </li>
                            <li id="popup-req-number" class="flex items-center">
                                <svg class="w-5 h-5 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                At least one number (0-9)
                            </li>
                            <li id="popup-req-special" class="flex items-center">
                                <svg class="w-5 h-5 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                                At least one special character (@$!%*?&)
                            </li>
                        </ul>
                        <div class="mt-6 flex justify-end">
                            <button type="button" id="understand-btn" class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200">
                                I Understand
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Confirm Password -->
                <div class="relative">
                    <label for="signup-confirm-password" class="block text-sm font-medium text-gray-700 mb-1">Confirm Password</label>
                    <div class="relative">
                        <input type="password" id="signup-confirm-password" name="confirm-password" placeholder="Re-enter password"
                            class="mt-1 block w-full px-3 py-2 pr-10 rounded-md border border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500 transition-colors duration-200"
                            required>
                        <button type="button" id="toggle-confirm-password" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 transition-colors duration-200"
                                style="top: 50%; transform: translateY(-50%);">
                            <svg id="eye-icon-confirm" class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                            </svg>
                            <svg id="eye-slash-icon-confirm" class="h-5 w-5 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"></path>
                            </svg>
                        </button>
                    </div>
                    <div id="confirm-password-error" class="text-red-500 text-xs mt-1 hidden">Passwords do not match</div>
                </div>
                
                <!-- Terms and Conditions -->
                <div class="flex items-start mt-4">
                    <input type="checkbox" id="terms" name="terms" class="mt-1 mr-2 rounded" required>
                    <label for="terms" class="text-sm text-gray-700">
                        I agree to the <a href="#" class="text-blue-600 hover:underline">Terms and Conditions</a>
                    </label>
                </div>
                <div id="terms-error" class="text-red-500 text-xs mt-1 hidden">You must agree to the terms and conditions</div>
                               
                <!-- Submit Button -->
                <button type="submit" id="signup-button"
                    class="w-full py-3 mt-4 font-semibold text-white bg-[#149CFC] rounded-md shadow-lg hover:bg-blue-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    Create Account
                </button>
            </form>
            
            <!-- Switch to Sign In -->
            <p class="mt-6 text-center text-sm text-gray-600">
                Already have an account?
                <a href="{{ url_for('signin') }}" id="switch-to-signin" class="font-medium text-[#149CFC] hover:text-blue-500 transition-colors duration-200">Sign in</a>
            </p>
        </div>
    </div>
</section>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const passwordInput = document.getElementById('signup-password');
        const confirmPasswordInput = document.getElementById('signup-confirm-password');
        const passwordPopup = document.getElementById('password-popup');
        const closePopup = document.getElementById('close-popup');
        const understandBtn = document.getElementById('understand-btn');
        let popupShown = false;

        // Show popup when password field is focused for the first time
        passwordInput.addEventListener('focus', function() {
            if (!popupShown) {
                showPasswordPopup();
                popupShown = true;
            }
        });

        // Password visibility toggle
        function setupPasswordToggle(input, toggleBtn, eyeIcon, eyeSlashIcon) {
            toggleBtn.addEventListener('click', function() {
                const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
                input.setAttribute('type', type);
                eyeIcon.classList.toggle('hidden');
                eyeSlashIcon.classList.toggle('hidden');
            });
        }
        
        setupPasswordToggle(
            passwordInput, 
            document.getElementById('toggle-password'), 
            document.getElementById('eye-icon'), 
            document.getElementById('eye-slash-icon')
        );
        
        setupPasswordToggle(
            confirmPasswordInput, 
            document.getElementById('toggle-confirm-password'), 
            document.getElementById('eye-icon-confirm'), 
            document.getElementById('eye-slash-icon-confirm')
        );

        // User type selection styling
        const userTypeLabels = document.querySelectorAll('label[class*="flex-1"]');
        userTypeLabels.forEach(label => {
            const input = label.querySelector('input[type="radio"]');
            const dot = label.querySelector('.w-2.h-2');
            
            input.addEventListener('change', function() {
                // Reset all labels
                userTypeLabels.forEach(l => {
                    l.classList.remove('border-blue-500', 'bg-blue-50');
                    l.querySelector('.w-2.h-2').classList.add('hidden');
                });
                
                // Style selected label
                if (input.checked) {
                    label.classList.add('border-blue-500', 'bg-blue-50');
                    dot.classList.remove('hidden');
                }
            });
        });

        // Real-time validation
        passwordInput.addEventListener('input', function() {
            validatePassword();
            // Update popup requirements in real-time
            if (passwordPopup && !passwordPopup.classList.contains('hidden')) {
                updatePopupRequirements(passwordInput.value);
            }
        });

        confirmPasswordInput.addEventListener('input', validateConfirmPassword);
        document.getElementById('signup-email').addEventListener('input', validateEmail);
        document.getElementById('signup-name').addEventListener('input', validateName);

        // Popup handlers
        closePopup.addEventListener('click', hidePasswordPopup);
        understandBtn.addEventListener('click', hidePasswordPopup);

        function showPasswordPopup() {
            passwordPopup.classList.remove('hidden');
            updatePopupRequirements(passwordInput.value);
        }

        function hidePasswordPopup() {
            passwordPopup.classList.add('hidden');
            passwordInput.focus();
        }

        function updatePopupRequirements(password) {
            const requirements = {
                'popup-req-length': password.length >= 6,
                'popup-req-uppercase': /(?=.*[A-Z])/.test(password),
                'popup-req-lowercase': /(?=.*[a-z])/.test(password),
                'popup-req-number': /(?=.*\d)/.test(password),
                'popup-req-special': /(?=.*[@$!%*?&])/.test(password)
            };

            Object.entries(requirements).forEach(([id, isValid]) => {
                const element = document.getElementById(id);
                const icon = element.querySelector('svg');
                if (isValid) {
                    icon.classList.remove('text-red-500');
                    icon.classList.add('text-green-500');
                    icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>';
                } else {
                    icon.classList.remove('text-green-500');
                    icon.classList.add('text-red-500');
                    icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>';
                }
            });
        }

        function validateName() {
            const name = document.getElementById('signup-name').value;
            const nameRegex = /^[A-Za-z\s]{2,50}$/;
            const errorElement = document.getElementById('name-error');
            
            if (name && !nameRegex.test(name)) {
                errorElement.classList.remove('hidden');
                return false;
            } else {
                errorElement.classList.add('hidden');
                return true;
            }
        }
        
        function validateEmail() {
            const email = document.getElementById('signup-email').value;
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            const errorElement = document.getElementById('email-error');
            
            if (email && !emailRegex.test(email)) {
                errorElement.classList.remove('hidden');
                return false;
            } else {
                errorElement.classList.add('hidden');
                return true;
            }
        }
        
        function validatePassword() {
            const password = passwordInput.value;
            let isValid = true;
            let errorMessage = '';
            
            if (password.length < 6) {
                isValid = false;
                errorMessage = 'Password must be at least 6 characters long';
            } else if (!/(?=.*[A-Z])/.test(password)) {
                isValid = false;
                errorMessage = 'Password must contain at least one uppercase letter';
            } else if (!/(?=.*[a-z])/.test(password)) {
                isValid = false;
                errorMessage = 'Password must contain at least one lowercase letter';
            } else if (!/(?=.*\d)/.test(password)) {
                isValid = false;
                errorMessage = 'Password must contain at least one number';
            } else if (!/(?=.*[@$!%*?&])/.test(password)) {
                isValid = false;
                errorMessage = 'Password must contain at least one special character (@$!%*?&)';
            }
            
            const errorElement = document.getElementById('password-error');
            if (!isValid && password.length > 0) {
                errorElement.textContent = errorMessage;
                errorElement.classList.remove('hidden');
                passwordInput.classList.add('border-red-500');
            } else {
                errorElement.classList.add('hidden');
                passwordInput.classList.remove('border-red-500');
            }
            
            // Also validate confirm password when password changes
            validateConfirmPassword();
            
            return isValid;
        }
        
        function validateConfirmPassword() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;
            const errorElement = document.getElementById('confirm-password-error');
            
            if (confirmPassword && password !== confirmPassword) {
                errorElement.classList.remove('hidden');
                confirmPasswordInput.classList.add('border-red-500');
                return false;
            } else {
                errorElement.classList.add('hidden');
                confirmPasswordInput.classList.remove('border-red-500');
                return true;
            }
        }
        
        function validateSignupForm() {
            const isNameValid = validateName();
            const isEmailValid = validateEmail();
            const isPasswordValid = validatePassword();
            const isConfirmPasswordValid = validateConfirmPassword();
            const isUserTypeSelected = document.querySelector('input[name="user-type"]:checked');
            const isTermsAccepted = document.getElementById('terms').checked;
            
            // User type validation
            const userTypeError = document.getElementById('user-type-error');
            if (!isUserTypeSelected) {
                userTypeError.classList.remove('hidden');
            } else {
                userTypeError.classList.add('hidden');
            }
            
            // Terms validation
            const termsError = document.getElementById('terms-error');
            if (!isTermsAccepted) {
                termsError.classList.remove('hidden');
            } else {
                termsError.classList.add('hidden');
            }

            // Show password popup if password is invalid
            if (!isPasswordValid && !popupShown) {
                showPasswordPopup();
                popupShown = true;
                return false;
            }
            
            return isNameValid && isEmailValid && isPasswordValid && isConfirmPasswordValid && isUserTypeSelected && isTermsAccepted;
        }
    });
</script>

<style>
    /* Smooth transitions */
    input, button, label {
        transition: all 0.2s ease-in-out;
    }
    
    /* Custom radio button styling */
    input[type="radio"]:checked + div .w-2.h-2 {
        display: flex;
    }
    
    input[type="radio"]:checked + div + span {
        color: #2563eb;
    }
    
    /* Popup animation */
    #password-popup {
        animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
        from {
            opacity: 0;
            transform: scale(0.9);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }
</style>

{% endblock %}